<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>설비점검체크시트</title>
  <script src="https://unpkg.com/html5-qrcode"></script><style>
    body {
      font-family: sans-serif;
      padding: 0;
      margin: 0;
      background: #f5f5f5;
      /* 글자 크기를 60%로 줄임 (기존 33.8px → 20.28px) */
      font-size: 20.28px;
    }
    .container {
      width: 100%;
      max-width: 100%;
      margin: 0;
      padding: 16px;
      /* 패딩 포함하여 전체 폭 유지 */
      box-sizing: border-box;
    }
    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 16px;
      margin: 0 0 20px 0;
      font-size: 20.28px;
    }
    textarea {
      resize: vertical;
      height: 80px;
    }
    textarea::placeholder {
      /* 기존 22px → 13.2px (60%) */
      font-size: 13.2px;
      color: #aaa;
    }
    .radio-group {
      display: flex;
      gap: 20px;
      margin-bottom: 8px;
    }
    .radio-group label {
      font-size: 20.28px;
    }
    .radio-group label:nth-child(1) { color: #007BFF; }
    .radio-group label:nth-child(2) { color: #FF3B30; }
    .radio-group input[type="radio"] {
      width: 32px;
      height: 32px;
      transform: scale(1.3);
      margin-right: 10px;
    }
    button,
    input[type="submit"] {
      width: 100%;
      padding: 20px;
      font-size: 20.28px;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #fff;
      cursor: pointer;
      margin-bottom: 20px;
    }
    label {
      font-size: 20.28px;
      display: block;
      margin-bottom: 8px;
    }
    #preview-wrapper {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
    }
    #preview-container {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 90vw;
      max-width: 400px;
      background: transparent;
      border-radius: 8px;
      overflow: hidden;
      padding: 0;
    }
    #preview {
      width: 100%;
      height: auto;
      display: block;
    }
    #closePreview {
      position: absolute;
      bottom: -60px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 16px;
      /* 기존 20px → 12px (60%) */
      font-size: 12px;
      border: 1px solid #333;
      background: #fff;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="text-align:center; margin-bottom:16px;">설비점검 체크시트</h2>
    <form id="checkForm">
      <label>일자</label>
      <input type="date" id="date" name="일자" required />

      <label>설비명</label>
      <select id="equipmentInput" name="설비명" required>
        <option value="" disabled selected>설비를 선택하세요</option>
        <option value="1호기">1호기</option>
        <option value="2호기">2호기</option>
        <option value="3호기">3호기</option>
      </select>

      <label>점검자</label>
      <select id="inspector" name="점검자">
        <option value="김">김정위</option>
        <option value="이">조찬재</option>
        <option value="박">강원철</option>
      </select>

      <label>점검시간</label>
      <input type="text" id="scanTime" name="점검시간" readonly placeholder="QR 스캔 시 자동 등록" />

      <label>QR 코드</label>
      <button type="button" onclick="scanQRCode('barcode')">QR 코드 스캔</button>
      <input type="text" id="barcode" name="QR코드" readonly placeholder="스캔된 QR코드" style="display:none;" />

      <label>주변 정리정돈, 선입선출</label>
      <div class="radio-group">
        <label><input type="radio" name="item_가" value="OK"> OK</label>
        <label><input type="radio" name="item_가" value="NG"> NG</label>
      </div>
      <textarea id="memo_가" name="가메모" placeholder="메모 입력"></textarea>

      <label>제품별 구분, 투입전 기존품 잔량없을 것</label>
      <div class="radio-group">
        <label><input type="radio" name="item_나" value="OK"> OK</label>
        <label><input type="radio" name="item_나" value="NG"> NG</label>
      </div>
      <textarea id="memo_나" name="나메모" placeholder="메모 입력"></textarea>

      <label>낙하품 폐기</label>
      <div class="radio-group">
        <label><input type="radio" name="item_다" value="OK"> OK</label>
        <label><input type="radio" name="item_다" value="NG"> NG</label>
      </div>
      <textarea id="memo_다" name="다메모" placeholder="메모 입력"></textarea>

      <label>세척액 청결상태 (교체시 일자기록, 예:4/5)</label>
      <div class="radio-group">
        <label><input type="radio" name="item_라" value="OK"> OK</label>
        <label><input type="radio" name="item_라" value="NG"> NG</label>
      </div>
      <textarea id="memo_라" name="라메모" placeholder="메모 입력"></textarea>

      <label>세척온도(33℃~45℃) (온도기록, 예:35)</label>
      <div class="radio-group">
        <label><input type="radio" name="item_마" value="OK"> OK</label>
        <label><input type="radio" name="item_마" value="NG"> NG</label>
      </div>
      <textarea id="memo_마" name="마메모" placeholder="메모 입력"></textarea>

      <label>세척시간(60초~180초) (시간기록, 예:65)</label>
      <div class="radio-group">
        <label><input type="radio" name="item_바" value="OK"> OK</label>
        <label><input type="radio" name="item_바" value="NG"> NG</label>
      </div>
      <textarea id="memo_바" name="바메모" placeholder="메모 입력"></textarea>

      <label>안전보호구 착용</label>
      <div class="radio-group">
        <label><input type="radio" name="item_사" value="OK"> OK</label>
        <label><input type="radio" name="item_사" value="NG"> NG</label>
      </div>
      <textarea id="memo_사" name="사메모" placeholder="메모 입력"></textarea>

      <label>N/A</label>
      <div class="radio-group">
        <label><input type="radio" name="item_아" value="OK" disabled> OK</label>
        <label><input type="radio" name="item_아" value="NG" disabled> NG</label>
      </div>
      <textarea id="memo_아" name="아메모" placeholder="메모 입력" disabled></textarea>

      <label>N/A</label>
      <div class="radio-group">
        <label><input type="radio" name="item_자" value="OK" disabled> OK</label>
        <label><input type="radio" name="item_자" value="NG" disabled> NG</label>
      </div>
      <textarea id="memo_자" name="자메모" placeholder="메모 입력" disabled></textarea>

      <label>N/A</label>
      <div class="radio-group">
        <label><input type="radio" name="item_차" value="OK" disabled> OK</label>
        <label><input type="radio" name="item_차" value="NG" disabled> NG</label>
      </div>
      <textarea id="memo_차" name="차메모" placeholder="메모 입력" disabled></textarea>

      <label>비고</label>
      <textarea id="comment" name="비고" placeholder="비고를 입력하세요"></textarea>

      <input type="submit" value="제출" />
    </form>
  </div>

  <div id="preview-wrapper">
    <div id="preview-container" onclick="stopQrScanner()">
      <div id="preview"></div>
      <button id="closePreview">닫기</button>
    </div>
  </div>

  <script>
    let html5QrCodeInstance;
    let currentScanTarget;

    function scanQRCode(targetId) {
      currentScanTarget = targetId;
      document.getElementById('preview-wrapper').style.display = 'block';
      html5QrCodeInstance = new Html5Qrcode('preview');
      html5QrCodeInstance.start(
        { facingMode: 'environment' },
        { fps: 10, qrbox: { width: 300, height: 300 } },
        decodedText => {
          document.getElementById(currentScanTarget).value = decodedText;
          document.getElementById('scanTime').value = new Date().toLocaleTimeString();
          alert(`스캔 결과: ${decodedText}`);
          stopQrScanner();
        },
        err => console.warn('QR 인식 실패:', err)\ n      ).catch(console.error);
    }

    function stopQrScanner() {
      document.getElementById('preview-wrapper').style.display = 'none';
      if (html5QrCodeInstance) {
        html5QrCodeInstance.stop().then(() => html5QrCodeInstance.clear()).catch(console.error);
      }
    }

    document.getElementById('closePreview').addEventListener('click', stopQrScanner);

    // --- 제출 부분만 첨부파일 소스 그대로 적용 ---
    document.getElementById("checkForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const formBody = new URLSearchParams(formData);

      fetch("https://script.google.com/macros/s/AKfycbwnyjb_adNhT3hxZst278neu7vZ5OxsTrwVLwBOVYfvye5XaQX6VT9tofQMx7MkrkpfXw/exec", {
        method: "POST",
        body: formBody
      })
      .then(response => response.text())
      .then(data => {
        alert("제출 완료: " + data);
        this.reset();
      })
      .catch(error => {
        alert("제출 실패: " + error);
      });
    });

    // 페이지 로드 시 오늘 날짜 세팅
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('date').value = new Date().toISOString().slice(0,10);
    });
  </script>
</body>
</html>
